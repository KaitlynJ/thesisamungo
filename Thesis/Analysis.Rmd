---
header-includes:
- \usepackage{graphicx,latexsym}
- \usepackage{amssymb,amsthm,amsmath}
- \usepackage{longtable,booktabs,setspace}
output: word_document
---
# Analysis {.unnumbered}
\doublespacing


A quick summary of the data shows that by and large most of the observations continue to choose traditional means of obcuring primary care. With cluster assignments established, I then analyzed how the identified groups differed from each other in terms of critical demographic chracteristics and behaviors that are described in the literature. In order to better understand the characteristics of individuals choosing to go to urgent care we must understand which chracteristics or bahaviors most distinguished the clusters in the anlaysis. 

old?
A quick summary of the data shows that by and large most of the observations continue to choose traditional means of obcuring primary care. Great quote: For our purposes, we do not presume to go quite this far, but we are applying this method as a form of retroduction, using observed evidence to create a research hypothesis that accounts for the observed facts *Sayer, 1992*.


## Identifying Typologies with Clustering{.unnumbered}

#### Differences in Demographic and Behavioral Factors of Urgent Care Seekers{.unnumbered}

In order to better understand the characteristics of individuals choosing to go to urgent care, we must first understand which characteristics or behaviors most distinguished the clusters in the cluster analysis, and to do this I used the k-modes clustering algorithm to situation observations into similar groups of patients. With cluster assignments established by the hierarchal agglomerative methods above, I then analyzed how the identified groups or 8 and 12 differed from each other in terms of critical demographic characteristics and visit behaviors that were described in the literature review. 

Beginning with demographic trends, the cluster analysis makes immediately clear that there are distinct homogenous groups within the selection of patients who utilize urgent care. Race in particular is immediately noticeable for its lack of variety: of the 12 clusters, 9 are predominantly or exclusively white, an unsurprising trend when one looks at the summary statistics (of the 3863 urgent care visits included in the data, 87% (3352) of those were white individuals). Table 1 shows the modes of each cluster for an illustrative sample of patients, and it is immediately clear that the majority of urgent care goers are white, but that within clusters of white patients there is further segmentation. 

For an example of such segmentation, we can examine the socioeconomic indicators for the patients’ ZIP codes which were included as demographic parameters. Unsurprisingly, these appeared to cluster and correlate with both race and income: for both males and females, there were consistent clusters of White, 25-44-year-old patients with private insurance, and both of these clusters were in the highest quartile of percent population with Bachelor’s degrees, the second lowest percent population under the poverty line (5-10%), and both visited clinics coded as being located in a “Large central metro” (Table 1.). 

In fact, if one predominant trend becomes clear from the demographic clustering, it is that urgent care centers are almost entirely an urban affair. Of the clusters found, all but one consisted of visits located in medium to large metros, indicating that while other variation between patients exists, most urgent care consumers are located in larger cities. And if its singularity wasn’t enough, the cluster of visits which did occur in a rural setting also differed from most other clusters in the other parameters as well. As can be seen in the first row of Table 1., the rural (“Micropolitan/noncore”) cluster of visits had one of the highest levels of localized poverty, one of the lowest levels of educational attainment, and was one of only two clusters where the majority of visits were paid with Medicaid.

Also informative are the clusters’ most occurring payment types, which complicate some of the theoretical notions of urgent care described in Chapter 1. While the largest clusters were consistently comprised of private insurance payers, Medicare without a doubt plays a role in getting people to urgent care centers. Medicare was listed as the primary payment method around 12 % of the time, a large number when one considers the consumerist theories proposed in chapter one. These clusters are crucial to understanding the decision process behind choosing a health care provider, while simultaneously raising the question of the relationship between the surprising number of elderly patients on Medicare seeking treatment at an urgent care centers.

The demographic characteristics of urgent care seekers were also clustered with behavioral, visit-level parameters in a second wave of cluster anlaysis, in order to to examine *how* urgent care is utilized by different groups. By far the largest and most homogenous clusters isolated consist of white, privately insured patients in medium to large urban environments. These trends match those found in the demographic clusters, and we can learn even more about this group by examining the cluster segmentation that occurred across their behavioral parameters in the second wave. Of the two clusters which consist almost entirely of white, 25-44-year-old men and women (yellow and light pink in Figure 1 above), both were almost entirely classed as “established patients”, with at least one past visit. Also theoretically interesting, neither cluster had observations whose reason for visiting was “injury related” and neither had recorded visits on weekends. Cluster one in particular (Row 1, Table 2), consisted of 25-44-year-old white females with private insurance, an established history of visiting urgent care, and a reason for their current visit coded as a “chronic, routine problem”. 

In fact, only 32 visits in the example model were coded as new patients (Figure 2, purple and orange), and examining these two clusters reveals what I referred to earlier as the traditional patient characteristics ascribed to urgent care visits. These two cluster show what many would expect, both consisted of white, privately insured, new patients, and both clusters contain the only observations which occurred on a weekend or were coded as injury related.  These characteristics are in line with what many hold as the purpose of urgent care centers, but they remain a small fraction of the recorded number of visits. Completely contradicting this idea, the other seven of the nine clusters identified have high levels of established patients with chronic or routine problems, with ages ranging for 15 to over 75.
	
As for the Medicare question, if the clusters which consist of primarily elderly patients are examined—rows 5 and 9 in Table 2 (Figure 2, magenta and blue)—we can begin to understand a little better the relatively large percentage of what many would consider non-emergent care utilizers and their relationship to urgent care. Cluster 5 consists entirely of white patients between 65 and 74, whose visits were recorded as routine and who have a minimum of 3 past visits at the same center. Cluster nine on the other hand has a slightly older age range of above 75, and visits which were all considered new problems. Also distinguishing, cluster nine is the only cluster with a majority of rural observations. When compared, it appears that there are two typologies of elderly urgent care seekers, the first of which may be using urgent in much the same ways as the younger and larger clusters of privately insured urbanites, while the second seems to rely on urgent care much more as an actually resource for urgent problems. 

*Insert cluster table here, appendix for now*

## Logistic Regression Analysis {.unnumbered}

The initital exploratory analysis shows clear typologies of urgent care seekers, and the next phase of the analysis uses those trends and tests for significance using logistic regression analysis. Tables 4.1 and 4.2 show the results of the two logistic regression models. 

For the odds of choosing to go to urgent care over other means of ambulatory care, there is a surprising lack of significance for whether or not the visit is injury related, and whether or not it is a weekend. Similarly, visits for routine and chronic issues have a higher chance of leading to an urgent care visit than problems less than 3 mos old. These trends both support Hypothesis 2: that urgent care centers are being used as a new mode of primary care.

For the second analysis, the outcome is no longer whether or not the visit was *at* urgent care, but whether or not an urgent care patient listed the urgent care center as their "Primary Health Provider". Interestingly, most of the significant variables' effects chagne direction when this is taken as the outcome. While high local income levels had a negative relationship with the decision to go to urgent care, it appears to very positively correlate with those who do use urgent care as their primary care. 

Many of the visit-specific variables that did not have a significant effect on the odds of choosing urgent care became significant when looking at urgent care as primary care. Unsurprisingly, whether or not the visit was injury related has a negative effect on the odds of the patient specifying that clinic as their PCP. 

There are some surprising trends in the secondary logistic model which deserve further study. Established patient, for example, have a significant negative correlation with the odds of a patient using urgent care as their primary care physician?



```{r logit_regression, echo=FALSE, warning=FALSE}
NAMCS.logit <- NAMCS.work
                        
# variable selection
logit.vars <- c("URGCARE","PRIMCARE","PCTPOVR", "HINCOMER", "PBAMORER", "URBANRUR", "RACER", "WEEKEND", "AGER", "SEX","PAYTYPER",
                "INJURY","SENBEFOR", "PASTVIS", "MAJOR")
logit.varset <- NAMCS.logit[logit.vars]
logit.varset <- na.omit(logit.varset)

# recoding
logit.varset$ZipHighIncome <- as.numeric(logit.varset$HINCOMER == "Quartile 4 ($52,388 or more)")
logit.varset$HighZipPov <- as.numeric(logit.varset$PCTPOVR == "Quartile 4 (20.00 percent or more)")
logit.varset$HighEduc<- as.numeric(logit.varset$PBAMORER == "Quartile 4 (31.69 percent or more)")
levels(logit.varset$URBANRUR) <- list(Urban=c("Large central metro", "Large fringe metro", "Medium metro"), 
                                      Rural=c("Micropolitan/noncore (nonmetro)", "Small metro"))
levels(logit.varset$AGER) <- list(YoungAdult=c("Under 15 years", "15-24 years"),
                                  WorkingAge=c("25-44 years", "45-64 years"),
                                  Retired=c("65-74 years", "75 years and over"))

levels(logit.varset$PAYTYPER) <- list(PrivateIns=c("Private insurance"),
                                  Medicaid=c("Medicaid"),
                                  Medicare=c("Medicare"),
                                  Other=c("Other", "No charge", "Unknown","Worker's compensation", "All sources of payment are blank", "Self-pay" ))

levels(logit.varset$MAJOR) <- list(NewProblem=c("New problem (less than 3 mos. onset)"),
                                      RoutineChronic=c("Pre-/Post-surgery", "Chronic problem, routine", "Chronic problem, flare-up"),
                                      Preventative=c("Preventive care"),
                                      Other=c("Blank", "No charge", "Pre-/Post-surgery"))

logit.varset$PASTVIS <- as.numeric(logit.varset$PASTVIS)


#urgentcareonly model
UC.varset <-subset(logit.varset, logit.varset$URGCARE == "Yes")

# make model matrices
dummiesFull.df <- as.data.frame(model.matrix(~., data=logit.varset)[,-1]) 
dummiesUC.df <- as.data.frame(model.matrix(~.,data = UC.varset)[,-1])


dummy.vars <- c("HighEduc", "HighZipPov", "ZipHighIncome", "MAJORPreventative", "MAJORRoutineChronic", "PASTVIS", "SENBEFORYes, established patient", "INJURYYes", "SEXMale", "AGERRetired", "AGERWorkingAge", "WEEKENDYES", "RACERWhite", "RACEROther", "URBANRURRural", "PRIMCAREYes", "URGCAREYes", "PAYTYPERMedicaid", "PAYTYPERMedicare", "PAYTYPEROther")
dummyFull.varset <- dummiesFull.df[dummy.vars]
dummyUC.varset <- dummiesUC.df[dummy.vars]

names(dummyFull.varset)[names(dummyFull.varset) == 'SENBEFORYes, established patient'] <- 'EstablishedPatient'
names(dummyUC.varset)[names(dummyUC.varset) == 'SENBEFORYes, established patient'] <- 'EstablishedPatient'

### summary stats ##

#summary(dummy.varset)

## LOGIT ##
#head(dummy.varset)
#summary(dummy.varset)
#sapply(dummy.varset, sd)
#xtabs(~ URGCAREYes + RACERWhite, data = dummy.varset)

logit.dem <- glm(URGCAREYes ~ INJURYYes + WEEKENDYES+ PAYTYPERMedicaid+PAYTYPERMedicare+PAYTYPEROther+EstablishedPatient + PASTVIS + MAJORPreventative + MAJORRoutineChronic, data = dummyFull.varset, family = binomial)
logit.beh <- glm(URGCAREYes ~ AGERWorkingAge + AGERRetired + SEXMale + RACERWhite + ZipHighIncome + URBANRURRural, data = dummyFull.varset, family = binomial)
logit.full <- glm(URGCAREYes ~ INJURYYes + WEEKENDYES+ PAYTYPERMedicaid+PAYTYPERMedicare+PAYTYPEROther+EstablishedPatient + PASTVIS + MAJORPreventative + MAJORRoutineChronic + AGERWorkingAge + AGERRetired + SEXMale + RACERWhite + ZipHighIncome + URBANRURRural, data = dummyFull.varset, family = binomial)


logit2.dem <- glm(PRIMCAREYes ~ INJURYYes + WEEKENDYES+ EstablishedPatient + PASTVIS + MAJORPreventative + MAJORRoutineChronic, data = dummyUC.varset, family = binomial)

logit2.beh <- glm(PRIMCAREYes ~ AGERWorkingAge + AGERRetired + SEXMale + RACERWhite + ZipHighIncome + URBANRURRural, data = dummyUC.varset, family = binomial)

logit2.full <- glm(PRIMCAREYes ~ INJURYYes + WEEKENDYES + PAYTYPERMedicaid + PAYTYPERMedicare + PAYTYPEROther + EstablishedPatient + PASTVIS + MAJORPreventative + MAJORRoutineChronic + AGERWorkingAge + AGERRetired + SEXMale + RACERWhite + ZipHighIncome + URBANRURRural, data = dummyUC.varset, family = binomial)



```

```{r logit_tables, warning=FALSE, message=FALSE  ,echo=FALSE ,results="asis"}

library(texreg)
texreg(list(logit.beh, logit.dem, logit.full), 
       caption = "Logistic model of the decision to go to urgent care.", 
       fontsize = "small", 
       custom.coef.names = c("Intercept", "Injury Related Visit", "Weekend Visit", "Medicaid" , "Medicare" , "Other" , "Established Patient", "Number Past Visits", "Visit Reason: Preventative", "Visit Reason: Routine/Chronic", "Age: Working", "Age: Retired", "Male", "Race: White", "High ZIP Income", "Rural"))

texreg(list(logit2.beh, logit2.dem, logit2.full), 
       caption = "Logistic model of the decision to use urgent care as primary care", 
       fontsize = "small",
       custom.coef.names = c("Intercept", "Injury Related Visit", "Weekend Visit", "Medicaid" , "Medicare" , "Other" , "Established Patient", "Number Past Visits", "Visit Reason: Preventative", "Visit Reason: Routine/Chronic", "Age: Working", "Age: Retired", "Male", "Race: White", "High ZIP Income", "Rural"))


```


```{r diagnostics}

library(ResourceSelection)
h1<- hoslem.test(dummiesUC.df$PRIMCAREYes, fitted(logit2.full, g =10))
h1
```




## Revisiting the hypotheses {.unnumbered}

















